import{C as v}from"./_compressorjs@1.1.1@compressorjs.9bd75bb1.js";import{_ as y}from"./plugin-vue_export-helper.21dcd24c.js";import{l as w,y as C,z as D,C as $,g as P}from"./_@vue_runtime-core@3.2.31@@vue.b0aa5f29.js";import{r as m}from"./_@vue_reactivity@3.2.31@@vue.435b5d06.js";import"./_@vue_shared@3.2.31@@vue.7f2d3904.js";const R=w({name:"upload-pics",props:["type"],setup(a,r){const t=m([]);m(!0);const s=P().appContext.config.globalProperties.$api,u=a.type=="headEmail"?"attachmentHeadMail":"attachment",l={status:"uploading",message:"\u4E0A\u4F20\u4E2D..."},d={status:"done",message:""},b={status:"failed",message:"\u4E0A\u4F20\u5931\u8D25"},g=n=>new Promise(e=>{new v(n,{quality:.4,success(o){e(o)},error(o){e(!1)}})}),h=n=>new Promise(async(e,o)=>{let f=await g(n);console.log(f),f||e(!1);let c=new FormData;c.append("file",f),c.append("flag","img"),s[u](c,{"Content-Type":"multipart/form-data"}).then(p=>{p.code==200?e(p.data):e(!1)}).catch(p=>{e(!1)})});return{fileList:t,afterRead:async n=>{t.value.map((e,o)=>{e.status||(t.value[o]=Object.assign({},e,l))});for(const e in t.value)if(t.value[e].status==="uploading"){const o=await h(t.value[e].file);o?t.value[e]=Object.assign({},t.value[e],d,o):t.value[e]=Object.assign({},t.value[e],b)}r.emit("receivePic",t.value)},beforeRead:n=>(r.emit("uploadDone",!1),!0)}},watch:{},data(){return{}},computed:{},watch:{},methods:{deleteImg(a,r){this.$emit("receivePic",this.fileList)},beforeDelete(a,r){return this.$emit("uploadDone",!1),new Promise((t,i)=>{if(a.status=="failed"){t(a);return}this.$api.removeAttachment({id:a.attachId},{"content-type":"application/json;charset=UTF-8"}).then(s=>{s.code==200?t(a):i()}).catch(s=>{i()})})}},created(){},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){}});function _(a,r,t,i,s,u){const l=C("van-uploader");return D(),$(l,{modelValue:a.fileList,"onUpdate:modelValue":r[0]||(r[0]=d=>a.fileList=d),onDelete:a.deleteImg,"before-read":a.beforeRead,"before-delete":a.beforeDelete,"after-read":a.afterRead,multiple:!0,"max-count":3},null,8,["modelValue","onDelete","before-read","before-delete","after-read"])}var U=y(R,[["render",_]]);export{U as default};
