import{v as p,a as m}from"./_@vue_runtime-dom@3.2.31@@vue.240af360.js";import{_}from"./plugin-vue_export-helper.21dcd24c.js";import{z as c,A as d,E as t,r as h,K as v,L as f}from"./_@vue_runtime-core@3.2.31@@vue.b0aa5f29.js";import{s as y,I as x}from"./_@vue_shared@3.2.31@@vue.7f2d3904.js";import"./_@vue_reactivity@3.2.31@@vue.435b5d06.js";const w={data(){return{type:1,msgText:"\u83B7\u53D6\u77ED\u4FE1\u9A8C\u8BC1\u7801",starTime:0,isEndTime:!0,countTime:null,times:60,showPass_1:!0,showPass_2:!0,login_o:{account_o:"",password_o:""},login_t:{account_t:"",password_t:""}}},components:{},methods:{onKeyInput(s,e,a){this[s][e]=a.target.value},validate(s=1,e){let a=[];s===1?a=[{name:"account_o",required:!0,type:"phone",errmsg:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7"},{name:"password_o",type:"required",errmsg:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}]:a=[{name:"account_t",type:"required",errmsg:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7/\u8D26\u53F7"},{name:"account_t",type:"lengthRange",min:"6",max:"12",errmsg:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7/\u8D26\u53F7"},{name:"password_t",type:"required",errmsg:"\u8BF7\u8F93\u5165\u5BC6\u7801"}];let l=this.$validate.validate(e,a);return l.isOk?!0:(uni.showToast({icon:"none",title:l.errmsg}),!1)},getMsg(){if(this.isEndTime){if(!this.$validate.isPhone(this.login_o.account_o)){uni.showToast({icon:"none",title:"\u624B\u673A\u53F7\u8F93\u5165\u6709\u8BEF"});return}this.$refs.popUp.showPop()}},getMsgApi(s){this.$api.sendMsg({phone:this.login_o.account_o},{"Content-Type":"application/x-www-form-urlencoded","Captcha-ImgKey":s.imgKey,"Captcha-ImgCode":s.imgCode}).then(e=>{uni.hideLoading(),e.code===200?(console.log(e),uni.setStorageSync("Captcha-Key",e.data.id),this.$refs.popUp.closePic(),this.reTime()):(uni.hideLoading(),uni.showToast({icon:"none",title:e.msg}))})},reTime(){this.starTime=this.times,this.countTime=setInterval(()=>{this.isEndTime=!1,--this.starTime,this.msgText=this.starTime+"s",this.starTime===0&&(this.clearTime(),this.starTime=this.times,this.isEndTime=!0,this.msgText="\u83B7\u53D6\u77ED\u4FE1\u9A8C\u8BC1\u7801")},1e3)},clearTime(){clearInterval(this.countTime)},changeShowPass(s){this[`showPass_${s}`]=!this[`showPass_${s}`]},gotoHome(){uni.reLaunch({url:"/pages/index/index"})},gotoRefresh(){uni.navigateTo({url:"/pages/refresh-account/refresh-account"})},regist(s){if(s===1)this.phoneRegist();else{if(!this.validate(s,this.login_t))return;this.accountRegist()}},loginCount(s,e){let a={type:s,fproductName:getApp().globalData.projectName,fregionCode:getApp().globalData.cityCode,fregionName:getApp().globalData.cityName};s===1?a.faccount=this.login_t.account_t:a.ftel=this.login_o.account_o,console.log(a),this.$api.loginCount(a,e).then(l=>{})},phoneRegist(){let s={"User-Type":"app","Captcha-Key":"","Captcha-Code":this.login_o.password_o};this.$api.regist({grantType:"saasCaptcha",mobile:this.login_o.account_o.toString(),refreshToken:"",tenantId:"000000"},s).then(e=>{e.code==200?(this.afterLogin(e),this.loginCount(2,1)):(uni.showToast({icon:"none",mask:!0,title:e.msg}),setTimeout(()=>{this.loginCount(2,2)},2e3))})},accountRegist(){this.$api.passwordLogin({password:Md5(this.login_t.password_t),tenantId:"000000",phone:this.login_t.account_t.toString(),grantType:"saasPassword"},{"User-Type":"app","Content-Type":"application/x-www-form-urlencoded"}).then(s=>{s.code==200?(this.afterLogin(s),this.loginCount(1,1)):(uni.showToast({icon:"none",mask:!0,title:s.msg}),setTimeout(()=>{this.loginCount(2,2)},2e3))})},afterLogin(s){let{access_token:e,user_id:a,account:l,phone:n,ent_id:i,login_status:o,last_login_time:g,login_time:u}=s.data;if(this.$handleLocalStorage("set","access_token",e||""),this.$handleLocalStorage("set","user_id",a||""),this.$handleLocalStorage("set","mobile",n||""),this.$handleLocalStorage("set","userName",l||""),this.$handleLocalStorage("set","login_status",o||""),this.$handleLocalStorage("set","last_login_time",g||""),this.$handleLocalStorage("set","login_time",u||""),i!=null&&i!=null&&i!=""?(this.$handleLocalStorage("set","chooseCompanyId",i),this.$handleLocalStorage("set","chooseSelf","false")):(this.$handleLocalStorage("set","policyCompanyId",""),this.$handleLocalStorage("set","chooseCompany","\u4E2A\u4EBA"),this.$handleLocalStorage("set","chooseSelf","true")),e){if(!l)return;uni.reLaunch({url:"/pages/index/index"})}},showModel(){let s=uni.getStorageSync("login_status")?uni.getStorageSync("login_status"):"1";this.$showModal({title:"\u63D0\u793A",content:s=="1"?"\u60A8\u5DF2\u767B\u5F55\u6210\u529F\uFF0C\u8BF7\u5C3D\u5FEB\u53BB\u201C\u6211\u7684/\u7CFB\u7EDF\u8BBE\u7F6E\u4E2D\u8BBE\u7F6E\u767B\u5F55\u8D26\u53F7\u548C\u5BC6\u7801":"\u60A8\u5DF2\u6CE8\u518C\u6210\u529F\uFF0C\u8BF7\u5C3D\u5FEB\u53BB\u201C\u6211\u7684/\u7CFB\u7EDF\u8BBE\u7F6E\u4E2D\u8BBE\u7F6E\u767B\u5F55\u8D26\u53F7\u548C\u5BC6\u7801",showCancel:!0,cancelText:"\u73B0\u5728\u53BB\u8BBE\u7F6E",confirmText:"\u7A0D\u540E\u8BBE\u7F6E",hideTabBar:!0,success:function(e){e.confirm?uni.reLaunch({url:"/pages/index/index"}):uni.reLaunch({url:"/pages/set-acount/set-acount?type=1"})}})}}},r=s=>(v("data-v-ad27f250"),s=s(),f(),s),T={class:"logins"},C=r(()=>t("div",{class:"title"},"\u6B22\u8FCE\u8FDB\u5165\u5E0C\u4F01\u901A",-1)),S={class:"btm"},L={class:"btm-content"},k={class:"inputs"},I=r(()=>t("div",{class:"text"},"\u672A\u6CE8\u518C\u7684\u624B\u673A\u53F7\u9A8C\u8BC1\u901A\u8FC7\u540E\u5C06\u81EA\u52A8\u6CE8\u518C",-1)),b={class:"inputs relative"},P={class:"btm-content relative"},R={class:"inputs"},E={class:"inputs relative"},K=["password"],M={class:"text text-flex flex",style:{color:"#838383","padding-top":"17px","margin-bottom":"42px"}},$={key:0,src:"../../static/login/icon_shutdown.png",mode:""},N={key:1,src:"../../static/login/icon_open.png",mode:""},A={class:"btm-content relative",style:{"padding-bottom":"20px"}},D=r(()=>t("image",{src:"../../static/login/icon_close1.png",mode:""},null,-1)),U=[D],q=r(()=>t("div",{class:"inputs"},[t("input",{type:"text",value:"",maxlength:"12",placeholder:"\u8D26\u53F76-12\u4F4D\u5B57\u7B26\uFF0C\u5B57\u6BCD\u548C\u6570\u5B57","placeholder-class":"placeholder"}),t("div",{class:"text"},"\u8D26\u53F7\u8BBE\u7F6E\u5B8C\u6210\u540E\u53EF\u7528\u8D26\u53F7\u548C\u5BC6\u7801\u767B\u5F55\uFF0C\u4E0D\u53EF\u518D\u6B21\u4FEE\u6539")],-1)),B={class:"inputs relative"},H=["password"],j=r(()=>t("div",{class:"text"},"8-12\u4F4D\u5B57\u6BCD\u548C\u6570\u5B57\uFF08\u533A\u5206\u5927\u5C0F\u5199\uFF09",-1)),z={key:0,src:"../../static/login/icon_shutdown.png",mode:""},V={key:1,src:"../../static/login/icon_open.png",mode:""},O=r(()=>t("div",{class:"inputs relative"},[t("input",{password:"",value:"",maxlength:"12",placeholder:"\u8BF7\u786E\u8BA4\u5BC6\u7801","placeholder-class":"placeholder"})],-1));function F(s,e,a,l,n,i){return c(),d("div",T,[C,t("div",S,[h(t("div",L,[t("div",k,[h(t("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=o=>n.login_o.account_o=o),maxlength:"11",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7","placeholder-class":"placeholder"},null,512),[[m,n.login_o.account_o]]),I]),t("div",b,[t("input",{type:"number",onInput:e[1]||(e[1]=o=>i.onKeyInput("login_o","password_o",o)),maxlength:"6",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801","placeholder-class":"placeholder"},null,32),t("div",{class:"text",style:{color:"#838383","padding-top":"17px",display:"inline-block"},onClick:e[2]||(e[2]=o=>n.type=2)},"\u5BC6\u7801\u767B\u5F55"),t("div",{class:"sp-text",onClick:e[3]||(e[3]=(...o)=>i.getMsg&&i.getMsg(...o)),style:y({color:n.isEndTime?"#236EED":"#C0C0C3"})},x(n.msgText),5)]),t("div",{class:"go-next",onClick:e[4]||(e[4]=o=>i.regist(1))})],512),[[p,n.type==1]]),h(t("div",P,[t("div",R,[t("input",{type:"text",value:"",maxlength:"12",onInput:e[5]||(e[5]=o=>i.onKeyInput("login_t","account_t",o)),placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u6216\u624B\u673A\u53F7","placeholder-class":"placeholder"},null,32)]),t("div",E,[t("input",{maxlength:"12",onInput:e[6]||(e[6]=o=>i.onKeyInput("login_t","password_t",o)),password:n.showPass_1,placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","placeholder-class":"placeholder"},null,40,K),t("div",M,[t("div",{onClick:e[7]||(e[7]=o=>n.type=1)},"\u9A8C\u8BC1\u7801\u767B\u5F55"),t("div",{onClick:e[8]||(e[8]=(...o)=>i.gotoRefresh&&i.gotoRefresh(...o))},"\u5FD8\u8BB0\u5BC6\u7801\uFF1F")]),t("div",{class:"sp-text",onClick:e[9]||(e[9]=o=>i.changeShowPass(1))},[n.showPass_1?(c(),d("image",$)):(c(),d("image",N))])]),t("div",{class:"go-next",onClick:e[10]||(e[10]=o=>i.regist(2))})],512),[[p,n.type==2]]),h(t("div",A,[t("div",{class:"absolute closed",onClick:e[11]||(e[11]=o=>n.type=1)},U),q,t("div",B,[t("input",{password:n.showPass_2,maxlength:"12",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","placeholder-class":"placeholder"},null,8,H),j,t("div",{class:"sp-text",onClick:e[12]||(e[12]=o=>i.changeShowPass(2))},[n.showPass_2?(c(),d("image",z)):(c(),d("image",V))])]),O,t("div",{class:"go-next-sp",onClick:e[13]||(e[13]=(...o)=>i.gotoHome&&i.gotoHome(...o))},"\u5B8C\u6210")],512),[[p,n.type==3]])])])}var Y=_(w,[["render",F],["__scopeId","data-v-ad27f250"]]);export{Y as default};
